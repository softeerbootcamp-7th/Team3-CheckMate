# 실시간 모니터링 지표 아키텍처 설계

## 1. 배경

본 시스템은 **사장님 대상 실시간 모니터링 서비스**로,  
주문 이벤트가 발생하면 SSE를 통해 매출 및 메뉴 지표를 실시간으로 전달한다.

하지만 지표 설계에서 다음과 같은 복잡성이 존재한다.

---

## 2. 문제 정의

### 2.1 동일한 지표지만 집계 기간이 다름

지표 자체는 동일하지만, 지표 카드마다 집계 기간이 다르다.

예시

```
SLS_01_01 → 오늘 실매출
SLS_01_02 → 이번주 실매출
SLS_01_03 → 이번달 실매출
```

정리

- 지표 계산 로직은 동일
- 집계 기간만 다름

---

### 2.2 같은 지표라도 화면에 따라 응답 구조가 다름

지표는 다음 두 화면에서 사용된다.

- 대시보드
- 상세 분석

#### 예시: 판매유형별 매출

대시보드
- 판매유형별 매출
- 비교기간 대비 매출 변화 필요
- 요약 데이터 필요

상세 분석
- 판매유형별 매출

정리

같은 지표라도 **응답 DTO 구조가 달라진다.**

---

### 2.3 지표 개수

현재 지표 개수

```
약 46개
```

단순한 if / switch 구조로 처리할 경우

- 코드 복잡도 증가
- 유지보수 어려움
- 확장 어려움

---

# 3. 해결 전략

다음 구조로 문제를 해결했다.

```
Processor
Context
Factory
Response 분리
```

핵심 목표

1. 지표 계산 로직 분리
2. 기간 처리 분리
3. 화면별 응답 분리
4. 확장 가능한 구조 설계

---

# 4. 전체 구조

시스템 구조



```
Factory → Context 생성
Processor → 지표 계산
Response → 화면별 DTO 제공
```
<img width="1001" height="788" alt="클래스다이어그램" src="https://github.com/user-attachments/assets/f60b3a16-5302-4ad6-ac54-f2d931a70656" />


---

# 5. Processor

## 역할

지표를 실제로 계산하는 컴포넌트

즉

- DB 조회

- 결과 생성

예시

```
AverageOrderAmountProcessor
CategorySalesProcessor
```

Processor 특징

```
지표 단위로 존재
```

예시

```
SLS_03(건당 평균가) → AverageOrderAmountProcessor
MNU_02(카테코리별 매출) → CategorySalesProcessor
```

인터페이스

```
AnalysisProcessor<T extends AnalysisContext>
```

구조

```
supports(analysisCardCode)
process(context)
```

Processor는

```
Context를 받아서 지표를 계산한다.
```

---

# 6. AnalysisContext

## 역할

지표 계산에 필요한 **기간 정보 제공**

예시

- 오늘
- 최근 7일
- 최근 30일
- 이번달
- 비교 기간

Processor는 기간을 직접 계산하지 않고

```
Context에서 가져다 사용한다.
```

구조

```
AnalysisContext (abstract)
 ├─ MenuAnalysisContext
 └─ SalesAnalysisContext
```


---

# 7. AnalysisContextFactory

## 역할

지표 카드 ID를 기반으로

```
적절한 Context 생성
```

즉

```
SLS_01_01 → 오늘
SLS_01_02 → 이번주
SLS_01_03 → 이번달
```

이 로직이 들어있는 컴포넌트이다.

구조

```
AnalysisContextFactory
 ├─ SalesAnalysisContextFactory
 └─ MenuAnalysisContextFactory
```

Factory 책임

```
지표 카드 → 기간 결정
```

---

# 8. Response 구조

지표는 두 가지 형태로 제공된다.

```
대시보드
상세 분석
```

이를 위해 **마커 인터페이스**를 사용했다.

---

## 8.1 DashboardAnalysisResponse

대시보드 전용 응답

예시

```
DashboardSalesTrendResponse
DashboardPeakTimeResponse
```

---

## 8.2 DetailAnalysisResponse

상세 분석 전용 응답

예시

```
DetailSalesTrendResponse
DetailPeakTimeResponse
```

---

# 9. AnalysisResponse

최종 SSE 응답 객체

구조

```
AnalysisResponse
 ├ analysisCardCode
 ├ dashboardAnalysisResponse
 └ detailAnalysisResponse
```

의미

```
같은 지표라도 화면에 맞는 데이터를 제공한다.
```



---

# 10. 이벤트 처리 흐름

전체 시스템 흐름
<img width="1508" height="1001" alt="aaaaaa" src="https://github.com/user-attachments/assets/08a0fe56-05ab-4b49-ae35-930f6238255a" />


---

