## 들어가며

CheckMate 프로젝트의 백엔드 인프라는 보안성 확보와 배포 자동화를 목표로 설계되었습니다. 기존의 고정 자격 증명 방식이 가진 보안 취약점을 해결하기 위해 OIDC와 AWS SSM을 결합한 아키텍처를 도입했습니다.

<br>

## 1. **기존 배포 방식의 보안 취약점 및 문제점**

전통적인 CI/CD 환경에서 사용되는 Access Key와 PEM Key는 관리 소홀 시 시스템 전반에 걸친 보안 사고의 원인이 됩니다.

### **1-1. AWS Access Key / Secret Key (고정 자격 증명)**

- **보안 한계**: GitHub Secrets 등에 저장된 Access Key가 노출될 경우, 해당 계정 내의 모든 AWS 자원에 대한 접근 권한이 탈취됩니다.
- **현실적 문제**: 비인가자의 자원 생성으로 인한 추가 비용 발생, 데이터베이스(RDS) 및 스토리지(S3) 데이터 유출 등의 문제가 발생할 수 있습니다.

### **1-2. PEM Key 및 SSH(Port 22) 개방**

- **보안 한계**: PEM Key 유출 시 서버 운영체제(OS)의 쉘 권한이 노출됩니다.
- **현실적 문제**:
    - 서버 내 소스 코드 및 설정 파일에 포함된 민감 정보가 직접적으로 유출됩니다.
    - 해커가 서버를 내부망(VPC) 침투를 위한 경로로 활용하여 다른 인프라 자원을 공격할 수 있습니다.
    - 배포를 위해 22번 포트를 상시 개방할 경우, 무차별 대입 공격(Brute-force)의 대상이 됩니다.

<br>

## **2. OIDC와 SSM을 통한 보안 모델 현대화**

CheckMate 프로젝트는 고정 키를 제거하고 서버 포트 노출을 최소화하기 위해 아래 기술을 적용했습니다.

### **2-1. OIDC: AWS IAM 역할을 활용한 임시 인증**

- **작동 원리**: GitHub Actions가 실행될 때마다 AWS OIDC 공급자로부터 신뢰를 확인받고, 정의된 AWS IAM 역할(Role)을 일시적으로 획득(Assume)합니다.
- **장점**: 고정된 액세스 키를 관리할 필요가 없는 **'Keyless'** 환경을 구축합니다. 특정 세션 동안만 유효한 임시 토큰을 사용하므로 키 유출에 따른 장기적인 보안 리스크가 제거됩니다.

### **2-2. SSM: 포트 개방 없는 원격 제어**

- **작동 원리**: AWS 내부 통신 경로인 Systems Manager를 통해 서버에 명령을 전달합니다.
- **장점**: EC2의 **22번(SSH) 포트를 차단**한 상태에서도 배포 명령을 수행할 수 있습니다. PEM 키 전송 및 보관 절차가 생략되어 관리 포인트가 줄어듭니다.

<br>

## **3. CD 파이프라인 흐름**

배포 과정은 다음 6단계의 자동화 프로세스로 운영됩니다.

1. **Trigger**: `main` 브랜치에 코드 푸시 발생.
2. **OIDC Authentication**: GitHub Actions가 지정된 IAM 역할(Role)의 임시 권한을 획득.
3. **Build & Push**: Java 17 환경에서 JAR 빌드 후 Docker 이미지를 생성하여 Docker Hub에 푸시.
4. **Staging**: `docker-compose.yml` 및 설정 파일들을 S3 버킷에 업로드.
5. **SSM Command**: SSM을 통해 EC2 인스턴스에 배포 스크립트 실행 명령 하달.
6. **Deployment**: EC2가 S3에서 설정 파일을 수신하고, GitHub Secrets 기반의 `.env` 파일을 생성하여 컨테이너 서비스를 갱신.


<br>


## **4. 런타임 보안: 민감 정보 관리**

애플리케이션 실행 환경에서도 보안을 유지하기 위해 설정을 분리하여 관리합니다.

- **Configuration Masking**: `application-prod.yml` 파일에는 실제 값 대신 `${DB_URL}`과 같은 변수(Placeholder)만 명시하여 소스 코드 내 보안 데이터 노출을 방지합니다.
- **Environment Variable Injection**: 배포 시점에 생성되는 `.env` 파일을 통해 실제 데이터를 주입하며, 해당 값은 서버의 환경변수 영역에만 존재합니다.

<br>

## 마치며

CheckMate의 배포 인프라는 OIDC 기반의 IAM 역할 활용과 SSM을 통한 포트리스(Port-less) 환경을 구축함으로써 인프라 보안 수준을 표준화했습니다. 이는 고정 키 관리 부담을 줄이고 비인가 접근 경로를 원천적으로 차단하는 효과를 가집니다.