import{j as h}from"./jsx-runtime-u17CrQMm.js";import{r as g}from"./iframe-CzL-WXHF.js";import"./periods-BlCP1VCB.js";import{R as I}from"./rankingColors-YVpIGQhO.js";const D={ANIMATION_DURATION:800,TOTAL_RADIUS:180,CLIP_RADIUS:100,MIN_PERCENTAGE_FOR_LABEL:5,LABEL_Y_OFFSET:9,MAX_DOUGHTNUT_ANGLE:359.99},O=e=>{const s=e.reduce((r,n)=>r+n.value,0);if(s===0)return e.map(r=>({label:r.label,percentage:0,color:r.color}));const t=e.map(r=>({label:r.label,color:r.color,percentage:Math.round(r.value/s*100)})),o=t.reduce((r,n)=>r+n.percentage,0);if(o<100){const r=100-o;for(let n=0;n<r;n++)t[n].percentage++}else if(o>100){const r=o-100;for(let n=0;n<r;n++)t[n].percentage>0&&t[n].percentage--}return t},U=e=>D.MAX_DOUGHTNUT_ANGLE*(e/100),y=(e,s,t)=>{const o=e/180*Math.PI,r=Math.PI/2-o,n=s*Math.cos(r)+t,i=-s*Math.sin(r)+t;return{x:n,y:i}},L=(e,s,t,o)=>{const n=s-e>180?1:0,{x:i,y:p}=y(e,t,o),{x:c,y:d}=y(s,t,o);return`M ${i} ${p} A ${t} ${t} 0 ${n} 1 ${c} ${d}`},C=e=>{try{const t=e.startsWith("var(")?getComputedStyle(document.documentElement).getPropertyValue(e.slice(4,-1).trim()).trim().slice(1):e.slice(1);return parseInt(t,16)>10066329?"var(--color-grey-900)":"var(--color-grey-0)"}catch{return"var(--color-grey-900)"}},S=({chartData:e,donutRadius:s,totalRadius:t,minPercentageForLabel:o})=>{const r=g.useRef([]),n=g.useRef([]),i=g.useMemo(()=>O(e),[e]),p=g.useMemo(()=>i.reduce((u,l,A)=>{const m=U(l.percentage),a=u.cumulativeAngle,T=u.cumulativeAngle+m,f=(a+T)/2,E=l.color??I[A%I.length];return u.segments.push({startAngle:a,endAngle:T,midAngle:f,color:E,label:l.label,percentage:l.percentage}),u.cumulativeAngle+=m,u},{segments:[],cumulativeAngle:0}).segments,[i]),c=g.useCallback(u=>{u.forEach((l,A)=>{const m=r.current[A],a=n.current[A],T=p[A];if(m){const f=L(l.startAngle,l.endAngle,s,t);m.setAttribute("d",f)}if(a&&T&&T.percentage>=o){const{x:f,y:E}=y(l.midAngle,s,t);a.setAttribute("x",Math.round(f).toString()),a.setAttribute("y",Math.round(E+D.LABEL_Y_OFFSET).toString()),a.setAttribute("opacity",l.labelOpacity.toString())}})},[p,s,t,o]),d=g.useCallback((u,l)=>{r.current[u]=l},[]),_=g.useCallback((u,l)=>{n.current[u]=l},[]);return{segments:p,onFrame:c,setSegmentRef:d,setLabelRef:_}},x=e=>e*(2-e),R=(e,s,t)=>e+(s-e)*t,G=(e,{duration:s,onFrame:t,disabled:o=!1})=>{const r=g.useRef([]),n=g.useRef(null),i=g.useRef(0),p=g.useCallback(()=>{const c=[...r.current];if(c.length!==e.length){for(;c.length<e.length;)c.push({startAngle:0,endAngle:0,midAngle:0,labelOpacity:0});c.splice(e.length)}const d=_=>{if(o){const m=e.map(a=>({startAngle:a.startAngle,endAngle:a.endAngle,midAngle:a.midAngle,labelOpacity:1}));r.current=m,t(m);return}i.current===0&&(i.current=_);const u=_-i.current,l=x(Math.min(1,u/s)),A=e.map((m,a)=>({startAngle:R(c[a].startAngle,m.startAngle,l),endAngle:R(c[a].endAngle,m.endAngle,l),midAngle:R(c[a].midAngle,m.midAngle,l),labelOpacity:l}));if(r.current=A,t(A),l>=1){i.current=0;return}n.current=requestAnimationFrame(d)};i.current=0,n.current=requestAnimationFrame(d)},[e,s,t,o]);g.useEffect(()=>{if(e.length!==0)return n.current&&(cancelAnimationFrame(n.current),n.current=null),p(),()=>{n.current&&cancelAnimationFrame(n.current)}},[e,p])},N=({ref:e,label:s,textColor:t})=>h.jsxs("text",{ref:e,x:0,y:0,opacity:0,fill:t,textAnchor:"middle",fontSize:"24px",fontWeight:600,children:[s,"%"]});N.__docgenInfo={description:"",methods:[],displayName:"DoughnutLabel",props:{ref:{required:!0,tsType:{name:"Ref",elements:[{name:"SVGTextElement"}],raw:"Ref<SVGTextElement>"},description:""},label:{required:!0,tsType:{name:"union",raw:"string | number",elements:[{name:"string"},{name:"number"}]},description:""},textColor:{required:!0,tsType:{name:"string"},description:""}}};const b=({ref:e,color:s,strokeWidth:t,path:o})=>h.jsx("path",{ref:e,d:o??"",opacity:1,stroke:s,strokeWidth:t,fill:"none"});b.__docgenInfo={description:"",methods:[],displayName:"DoughnutSegment",props:{ref:{required:!1,tsType:{name:"Ref",elements:[{name:"SVGPathElement"}],raw:"Ref<SVGPathElement>"},description:""},color:{required:!0,tsType:{name:"string"},description:""},strokeWidth:{required:!0,tsType:{name:"number"},description:""},path:{required:!1,tsType:{name:"string"},description:""}}};const M=({title:e,chartData:s,animationDuration:t=D.ANIMATION_DURATION,totalRadius:o=D.TOTAL_RADIUS,clipRadius:r=D.CLIP_RADIUS,minPercentageForLabel:n=D.MIN_PERCENTAGE_FOR_LABEL,disableAnimation:i=!1})=>{const p=o*2,c=o-r,d=r+c/2,_=g.useId(),{onFrame:u,segments:l,setLabelRef:A,setSegmentRef:m}=S({chartData:s,donutRadius:d,totalRadius:o,minPercentageForLabel:n});return G(l,{onFrame:u,duration:t,disabled:i}),h.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:`0 0 ${p} ${p}`,"aria-labelledby":_,children:[h.jsx("title",{id:_,children:e}),h.jsx(b,{color:"var(--color-grey-100)",strokeWidth:c,path:L(0,D.MAX_DOUGHTNUT_ANGLE,d,o)}),l.map((a,T)=>h.jsxs("g",{children:[h.jsx(b,{ref:f=>m(T,f),color:a.color,strokeWidth:c}),a.percentage>=n&&h.jsx(N,{ref:f=>A(T,f),label:a.percentage,textColor:C(a.color)})]},a.label))]})};M.__docgenInfo={description:"",methods:[],displayName:"DoughnutChart",props:{title:{required:!0,tsType:{name:"string"},description:""},chartData:{required:!0,tsType:{name:"Array",elements:[{name:"DoughnutChartItem"}],raw:"DoughnutChartItem[]"},description:""},animationDuration:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"DOUGHNUT_CHART_DEFAULT.ANIMATION_DURATION",computed:!0}},totalRadius:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"DOUGHNUT_CHART_DEFAULT.TOTAL_RADIUS",computed:!0}},clipRadius:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"DOUGHNUT_CHART_DEFAULT.CLIP_RADIUS",computed:!0}},minPercentageForLabel:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"DOUGHNUT_CHART_DEFAULT.MIN_PERCENTAGE_FOR_LABEL",computed:!0}},disableAnimation:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}}}};export{M as D};
