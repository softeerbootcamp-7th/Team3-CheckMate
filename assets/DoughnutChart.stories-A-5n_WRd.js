import{j as c}from"./jsx-runtime-u17CrQMm.js";import{r as p}from"./iframe-CebIkQcA.js";import"./periods-BlCP1VCB.js";import{R as y}from"./rankingColors-YVpIGQhO.js";import"./preload-helper-Cv0CY36J.js";const _={ANIMATION_DURATION:800,TOTAL_RADIUS:180,CLIP_RADIUS:100,MIN_PERCENTAGE_FOR_LABEL:5,LABEL_Y_OFFSET:9,MAX_DOUGHTNUT_ANGLE:359.99},L=e=>{const a=e.reduce((n,t)=>n+t.value,0);if(a===0)return e.map(n=>({label:n.label,percentage:0,color:n.color}));const r=e.map(n=>({label:n.label,color:n.color,percentage:Math.round(n.value/a*100)})),o=r.reduce((n,t)=>n+t.percentage,0);if(o<100){const n=100-o;for(let t=0;t<n;t++)r[t].percentage++}else if(o>100){const n=o-100;for(let t=0;t<n;t++)r[t].percentage>0&&r[t].percentage--}return r},O=e=>_.MAX_DOUGHTNUT_ANGLE*(e/100),N=(e,a,r)=>{const o=e/180*Math.PI,n=Math.PI/2-o,t=a*Math.cos(n)+r,l=-a*Math.sin(n)+r;return{x:t,y:l}},S=(e,a,r,o)=>{const t=a-e>180?1:0,{x:l,y:m}=N(e,r,o),{x:i,y:A}=N(a,r,o);return`M ${l} ${m} A ${r} ${r} 0 ${t} 1 ${i} ${A}`},v=e=>{try{const r=e.startsWith("var(")?getComputedStyle(document.documentElement).getPropertyValue(e.slice(4,-1).trim()).trim().slice(1):e.slice(1);return parseInt(r,16)>10066329?"var(--color-grey-900)":"var(--color-grey-0)"}catch{return"var(--color-grey-900)"}},U=({chartData:e,donutRadius:a,totalRadius:r,minPercentageForLabel:o})=>{const n=p.useRef([]),t=p.useRef([]),l=p.useMemo(()=>L(e),[e]),m=p.useMemo(()=>l.reduce((d,s,h)=>{const g=O(s.percentage),u=d.cumulativeAngle,b=d.cumulativeAngle+g,f=(u+b)/2,E=s.color??y[h%y.length];return d.segments.push({startAngle:u,endAngle:b,midAngle:f,color:E,label:s.label,percentage:s.percentage}),d.cumulativeAngle+=g,d},{segments:[],cumulativeAngle:0}).segments,[l]),i=p.useCallback(d=>{d.forEach((s,h)=>{const g=n.current[h],u=t.current[h],b=m[h];if(g){const f=S(s.startAngle,s.endAngle,a,r);g.setAttribute("d",f)}if(u&&b&&b.percentage>=o){const{x:f,y:E}=N(s.midAngle,a,r);u.setAttribute("x",Math.round(f).toString()),u.setAttribute("y",Math.round(E+_.LABEL_Y_OFFSET).toString()),u.setAttribute("opacity",s.labelOpacity.toString())}})},[m,a,r,o]),A=p.useCallback((d,s)=>{n.current[d]=s},[]),T=p.useCallback((d,s)=>{t.current[d]=s},[]);return{segments:m,onFrame:i,setSegmentRef:A,setLabelRef:T}},M=e=>e*(2-e),R=(e,a,r)=>e+(a-e)*r,j=(e,{duration:a,onFrame:r,disabled:o=!1})=>{const n=p.useRef([]),t=p.useRef(null),l=p.useRef(0),m=p.useCallback(()=>{const i=[...n.current];if(i.length!==e.length){for(;i.length<e.length;)i.push({startAngle:0,endAngle:0,midAngle:0,labelOpacity:0});i.splice(e.length)}const A=T=>{if(o){const g=e.map(u=>({startAngle:u.startAngle,endAngle:u.endAngle,midAngle:u.midAngle,labelOpacity:1}));n.current=g,r(g);return}l.current===0&&(l.current=T);const d=T-l.current,s=M(Math.min(1,d/a)),h=e.map((g,u)=>({startAngle:R(i[u].startAngle,g.startAngle,s),endAngle:R(i[u].endAngle,g.endAngle,s),midAngle:R(i[u].midAngle,g.midAngle,s),labelOpacity:s}));if(n.current=h,r(h),s>=1){l.current=0;return}t.current=requestAnimationFrame(A)};l.current=0,t.current=requestAnimationFrame(A)},[e,a,r,o]);p.useEffect(()=>{if(e.length!==0)return t.current&&(cancelAnimationFrame(t.current),t.current=null),m(),()=>{t.current&&cancelAnimationFrame(t.current)}},[e,m])},I=({ref:e,label:a,textColor:r})=>c.jsxs("text",{ref:e,x:0,y:0,opacity:0,fill:r,textAnchor:"middle",fontSize:"24px",fontWeight:600,children:[a,"%"]});I.__docgenInfo={description:"",methods:[],displayName:"DoughnutLabel",props:{ref:{required:!0,tsType:{name:"Ref",elements:[{name:"SVGTextElement"}],raw:"Ref<SVGTextElement>"},description:""},label:{required:!0,tsType:{name:"union",raw:"string | number",elements:[{name:"string"},{name:"number"}]},description:""},textColor:{required:!0,tsType:{name:"string"},description:""}}};const x=({ref:e,color:a,strokeWidth:r,path:o})=>c.jsx("path",{ref:e,d:o??"",opacity:1,stroke:a,strokeWidth:r,fill:"none"});x.__docgenInfo={description:"",methods:[],displayName:"DoughnutSegment",props:{ref:{required:!1,tsType:{name:"Ref",elements:[{name:"SVGPathElement"}],raw:"Ref<SVGPathElement>"},description:""},color:{required:!0,tsType:{name:"string"},description:""},strokeWidth:{required:!0,tsType:{name:"number"},description:""},path:{required:!1,tsType:{name:"string"},description:""}}};const C=({title:e,chartData:a,animationDuration:r=_.ANIMATION_DURATION,totalRadius:o=_.TOTAL_RADIUS,clipRadius:n=_.CLIP_RADIUS,minPercentageForLabel:t=_.MIN_PERCENTAGE_FOR_LABEL,disableAnimation:l=!1})=>{const m=o*2,i=o-n,A=n+i/2,T=p.useId(),{onFrame:d,segments:s,setLabelRef:h,setSegmentRef:g}=U({chartData:a,donutRadius:A,totalRadius:o,minPercentageForLabel:t});return j(s,{onFrame:d,duration:r,disabled:l}),c.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:`0 0 ${m} ${m}`,"aria-labelledby":T,children:[c.jsx("title",{id:T,children:e}),c.jsx(x,{color:"var(--color-grey-100)",strokeWidth:i,path:S(0,_.MAX_DOUGHTNUT_ANGLE,A,o)}),s.map((u,b)=>c.jsxs("g",{children:[c.jsx(x,{ref:f=>g(b,f),color:u.color,strokeWidth:i}),u.percentage>=t&&c.jsx(I,{ref:f=>h(b,f),label:u.percentage,textColor:v(u.color)})]},u.label))]})};C.__docgenInfo={description:"",methods:[],displayName:"DoughnutChart",props:{title:{required:!0,tsType:{name:"string"},description:""},chartData:{required:!0,tsType:{name:"Array",elements:[{name:"DoughnutChartItem"}],raw:"DoughnutChartItem[]"},description:""},animationDuration:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"DOUGHNUT_CHART_DEFAULT.ANIMATION_DURATION",computed:!0}},totalRadius:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"DOUGHNUT_CHART_DEFAULT.TOTAL_RADIUS",computed:!0}},clipRadius:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"DOUGHNUT_CHART_DEFAULT.CLIP_RADIUS",computed:!0}},minPercentageForLabel:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"DOUGHNUT_CHART_DEFAULT.MIN_PERCENTAGE_FOR_LABEL",computed:!0}},disableAnimation:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}}}};const V={title:"components/shared/doughnut-chart/DoughnutChart",component:C,parameters:{layout:"centered"},tags:["autodocs"]},G=()=>{const[e,a]=p.useState(F),r=(t,l)=>a(m=>m.map((i,A)=>A===t?{...i,...l}:i)),o=()=>a(t=>[...t,{label:`Custom ${t.length+1}`,value:10,color:"#0EA5E9"}]),n=()=>a(t=>t.map(l=>({...l,value:Math.round(Math.random()*60)+5})));return c.jsxs(c.Fragment,{children:[c.jsx(C,{title:"도넛 차트 접근성 제목",chartData:e,animationDuration:600}),c.jsxs("section",{"aria-label":"차트 데이터 조정",children:[c.jsx("p",{className:"body-large-medium mb-2",children:"chartData"}),e.map((t,l)=>c.jsx(P,{index:l,segment:t,onChange:m=>r(l,m),onRemove:()=>a(m=>m.filter((i,A)=>A!==l))},`${t.label}-${l}`)),c.jsx("button",{onClick:o,className:"bg-brand-50 rounded-200 body-small-medium my-2 block w-fit px-2",children:"슬라이스 추가"}),c.jsx("button",{onClick:n,className:"bg-brand-50 rounded-200 body-small-medium block w-fit px-2",children:"무작위 값"})]})]})},D={render:()=>c.jsx(G,{})},F=[{label:"카드",value:237,color:y[0]},{label:"현금",value:256,color:y[1]},{label:"간편결제",value:753,color:y[2]},{label:"기타",value:389,color:y[3]}],P=({index:e,segment:a,onChange:r,onRemove:o})=>c.jsxs("div",{className:"border-b-grey-300 mb-1 grid grid-cols-4 items-center gap-2 border-b",children:[c.jsx("input",{"aria-label":`Label ${e}`,value:a.label,onChange:n=>r({label:n.target.value})}),c.jsx("input",{type:"number",min:0,value:a.value,onChange:n=>r({value:Math.max(0,Number(n.target.value))})}),c.jsx("input",{type:"color",value:a.color||"#000000",onChange:n=>r({color:n.target.value})}),c.jsx("button",{type:"button",onClick:o,className:"bg-brand-50 rounded-200 body-small-medium w-fit px-2",children:"제거"})]});D.parameters={...D.parameters,docs:{...D.parameters?.docs,source:{originalSource:`{
  render: () => <DoughnutChartStory />
}`,...D.parameters?.docs?.source}}};const B=["Playground"];export{D as Playground,B as __namedExportsOrder,V as default};
